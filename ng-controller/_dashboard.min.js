Array.prototype.toQueryString = function(){
    var out = new Array();

    for(key in this){
        out.push(key + '=' + encodeURIComponent(this[key]));
    }

    return out.join('&');
}
var notif;
function closeNotif(tag){
	console.log(tag);
    chrome.notifications.clear(tag);
}
angular.module("RDash",["ui.bootstrap","ui.router","ngCookies","cuppaDatepickerDirective","chart.js","naif.base64","ngFileUpload","angucomplete","angular-jquery-locationpicker"],function($httpProvider){
	$httpProvider.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded;charset=utf-8';

  /**
   * The workhorse; converts an object to x-www-form-urlencoded serialization.
   * @param {Object} obj
   * @return {String}
   */ 
  var param = function(obj) {
    var query = '', name, value, fullSubName, subName, subValue, innerObj, i;

    for(name in obj) {
      value = obj[name];

      if(value instanceof Array) {
        for(i=0; i<value.length; ++i) {
          subValue = value[i];
          fullSubName = name + '[' + i + ']';
          innerObj = {};
          innerObj[fullSubName] = subValue;
          query += param(innerObj) + '&';
        }
      }
      else if(value instanceof Object) {
        for(subName in value) {
          subValue = value[subName];
          fullSubName = name + '[' + subName + ']';
          innerObj = {};
          innerObj[fullSubName] = subValue;
          query += param(innerObj) + '&';
        }
      }
      else if(value !== undefined && value !== null)
        query += encodeURIComponent(name) + '=' + encodeURIComponent(value) + '&';
    }

    return query.length ? query.substr(0, query.length - 1) : query;
  };

  // Override $http service's default transformRequest
  $httpProvider.defaults.transformRequest = [function(data) {
    return angular.isObject(data) && String(data) !== '[object File]' ? param(data) : data;
  }];
});
"use strict";
angular.module("RDash").filter("trust", ['$sce', function($sce) {
  return function(htmlCode){
    return $sce.trustAsHtml(htmlCode);
  }
}]);
angular.module("RDash").config(function($stateProvider,$urlRouterProvider){
	$urlRouterProvider.otherwise("/"),
	$stateProvider.state("index",{
		url:"/",
		templateUrl:"templates/dashboard.html"
	}).state("laporan",{
		url:"/laporan_personil",
		templateUrl:"templates/laporan_personil.html",
		controller:"Laporan_personil"
	}).state("pesan",{
		url:"/pesan",
		templateUrl:"templates/pesan.html",
		controller:"Pesan"
	}).state("pesan_baru",{
		url:"/pesan_baru",
		templateUrl:"templates/pesan_form.html",
		controller:"Pesan_baru"
	}).state("hitung_absensi",{
		url:"/hitung_absensi",
		templateUrl:"templates/hitung_absensi.html",
		controller:"Hitung_Absensi"
	}).state("absensi",{
		url:"/absensi",
		templateUrl:"templates/absensi.html",
		controller:"Absensi"
	}).state("detail_pesan",{
		url:"/detail_pesan/:ID",
		templateUrl:"templates/pesan_detail.html",
		controller:"Pesan_detail"
	}).state("klien",{
		url:"/klien",
		templateUrl:"templates/klien.html",
		controller:"Klien"
	}).state("klien_baru",{
		url:"/klien_baru",
		templateUrl:"templates/klien_form.html",
		controller:"Klien_baru"
	}).state("edit_klien",{
		url:"/edit_klien/:ID",
		templateUrl:"templates/klien_form.html",
		controller:"Edit_klien"
	}).state("detail_klien",{
		url:"/detail_klien/:ID",
		templateUrl:"templates/klien_detail.html",
		controller:"Detail_klien"
	}).state("proyek",{
		url:"/proyek",
		templateUrl:"templates/proyek.html",
		controller:"Proyek"
	}).state("proyek_baru",{
		url:"/proyek_baru",
		templateUrl:"templates/proyek_form.html",
		controller:"Proyek_baru"
	}).state("edit_proyek",{
		url:"/edit_proyek/:ID",
		templateUrl:"templates/proyek_form.html",
		controller:"Edit_proyek"
	}).state("regu",{
		url:"/regu",
		templateUrl:"templates/regu.html",
		controller:"Regu"
	}).state("regu_baru",{
		url:"/regu_baru",
		templateUrl:"templates/regu_form.html",
		controller:"Regu_baru"
	}).state("edit_regu",{
		url:"/edit_regu/:ID",
		templateUrl:"templates/regu_form.html",
		controller:"Regu_edit"
	}).state("anggota_regu",{
		url:"/anggota_regu/:ID",
		templateUrl:"templates/regu_edit_anggota.html",
		controller:"Edit_anggota_regu"
	}).state("personil",{
		url:"/personil",
		templateUrl:"templates/personil.html",
		controller:"Personil"
	}).state("personil_baru",{
		url:"/personil_baru",
		templateUrl:"templates/personil_form.html",
		controller:"Personil_baru"
	}).state("edit_personil",{
		url:"/edit_personil/:ID",
		templateUrl:"templates/personil_form.html",
		controller:"Edit_personil"
	}).state("video_call",{
		url:"/video_call/:ID",
		templateUrl:"templates/video_call.html",
		controller:"Video_call"
	}).state("cabang",{
		url:"/cabang",
		templateUrl:"templates/cabang.html",
		controller:"Cabang"
	}).state("cabang_baru",{
		url:"/cabang_baru",
		templateUrl:"templates/cabang_form.html",
		controller:"Cabang_baru"
	}).state("edit_cabang",{
		url:"/edit_cabang/:ID",
		templateUrl:"templates/cabang_form.html",
		controller:"Edit_cabang"
	}).state("panic_signal",{
		url:"/panic_signal",
		templateUrl:"templates/panic_signal.html",
		controller:"Panic_signal"
	}).state("laporan_isu_keamanan",{
		url:"/lap_isu_keamanan/detail/:ID",
		templateUrl:"templates/laporan_isu_keamanan_detail.html",
		controller:"Lap_isu_keamanan_detail"
	}).state("personil_detail",{
		url:"/personil_detail/:ID",
		templateUrl:"templates/personil_detail.html",
		controller:"Personil_detail"
	}).state("managemen_arsip",{
		url:"/managemen_arsip",
		templateUrl:"templates/managemen_arsip.html",
		controller:"Managemen_arsip"
	}).state("online_chatting",{
		url:"/online_chatting",
		templateUrl:"templates/online_chatting.html",
		controller:"Online_chatting"
	}).state("command_center",{
		url:"/command_center",
		templateUrl:"templates/command_center.html",
		controller:"Command_center"
	}).state("administrator",{
		url:"/administrator",
		templateUrl:"templates/administrator.html",
		controller:"Administrator"
	}).state("admin_baru",{
		url:"/admin_baru",
		templateUrl:"templates/administrator_form.html",
		controller:"Administrator_baru"
	})
}).run(function($rootScope,$filter,$timeout,$interval,$http){
	$rootScope.apiUrl = function(obj){
		return "http://103.27.207.198:8080/SiappApi" + obj;
	}
	// if (Notification.permission !== "granted") Notification.requestPermission();
	$rootScope.database = firebase.database();
	$rootScope.database.ref("ocn").on('value',function(snapshot){
		// var data = snapshot.val();
		// if(data){
		// 	data.icon = "http://sigapp.net/web/wp-content/uploads/2017/01/LOGO-BIMA-OK-2.png";
		// 	jQuery.playSound('sound/notif');
		// 	if(typeof notif === "undefined"){
		// 		notif = new Notification(data.title,data).onclick = function(){
		// 			$rootScope.onlineChat(data.ref);
		// 			$rootScope.database.ref("ocn").set(null);
		// 		}
		// 	} else {
		// 		var notification = {
		// 		    type:"basic",
		// 		    title:data.title,
		// 		    message:data.body,
		// 		    iconUrl:data.icon
		// 		};
		// 		chrome.notifications.create(data.tag,notification);
		// 		chrome.notifications.onClicked.addListener(closeNotif(data.tag));
		// 		$rootScope.database.ref("ocn").set(null);
		// 	}	
		// }
	});
	$rootScope.convertDate = function(date) {
		var yyyy = date.getFullYear().toString();
		var mm = (date.getMonth()+1).toString();
		var dd  = date.getDate().toString();
		var mmChars = mm.split('');
		var ddChars = dd.split('');
		return yyyy + '-' + (mmChars[1]?mm:"0"+mmChars[0]) + '-' + (ddChars[1]?dd:"0"+ddChars[0]);
	}
	$rootScope.dataChat = {};
	$rootScope.initChatdata = function(){
		var todaysDate = new Date();
		var today = $rootScope.convertDate(todaysDate).substring(2).trim();
		$rootScope.ref = $rootScope.database.ref('chatting/'+today);
		console.log('chatting/'+today);
		var i = 0;
		$rootScope.ref.on('value', function(snapshot){
			snapshot.forEach(function(childSnapshot) {
				var key = childSnapshot.key;
			    var val = childSnapshot.val();
			    $rootScope.dataChat[key] = {
			    	last_chat : {},
			    	count : 0
			    };
			    childSnapshot.forEach(function(childSnapshot2){
			    	$rootScope.dataChat[key].last_chat = childSnapshot2.val();
			    	$rootScope.dataChat[key].count++;
			    });
			});
		});
	}
	$interval(function(){
		console.log($rootScope.dataChat);
	}, 3000);
	$rootScope.onlineChat = function(ref){
		var data = {
			ref : ref,
			n : 'Call Center',
			h : ''
		};
		public_chatting(data);
	}
	$timeout(function(){
		$rootScope.initChatdata();
	}, 3000);
	$rootScope.page_title = "PT. JAGA NUSANTARA SATU";
	$rootScope.breadcrumb_text = "Graha Anabatic Lantai 7 Jalan Scientia Boulevard Kav U2 Summarecon Serpong, Curug Sangereng, Kelapa Dua, Tangerang, Banten (15810).";
	$rootScope.toastTimeout = 5000;
	$rootScope.notifikasi_baru = 0;
	$rootScope.notifikasi_terakhir = [];
	$rootScope.nama_bulan = ["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"];
	$rootScope.angka_bulan = ["01","02","03","04","05","06","07","08","09","10","11","12"];
	$rootScope.clear_notifikasi_baru = function(){
		$http.get('api/index.php/notifikasi/clear').then(function(response){
			console.log(response);
		});
	}
	$interval(function(){
		// $http.get('api/index.php/notifikasi/cek').then(function(response){
		// 	if($rootScope.notifikasi_baru<parseInt(response.data.notifikasi_baru)){
		// 		jQuery.playSound('sound/notif');
		// 	}
		// 	$rootScope.notifikasi_baru = parseInt(response.data.notifikasi_baru);
		// 	$rootScope.notifikasi_terakhir = response.data.notifikasi_terakhir;
		// });
	},3500);
	$rootScope.mydatetime = function(_date){
		return $filter('date')(new Date(_date),'dd/MM/yyyy HH:mm');
	}
	$rootScope.mydate = function(_date){
		return $filter('date')(new Date(_date),'dd/MM/yyyy');
	}
	$rootScope.mytime = function(_date){
		return $filter('date')(new Date(_date),'HH:mm');
	}
	$rootScope.intval = function(string_int){
		return parseInt(string_int);
	}
	$rootScope.myAge = function(bd) { // birthday is a date
		birthday = new Date(bd);
	    var ageDifMs = Date.now() - birthday.getTime();
	    var ageDate = new Date(ageDifMs); // miliseconds from epoch
	    return Math.abs(ageDate.getUTCFullYear() - 1970);
	}
});

//Script untuk MAP API penglokasian daerah satpam
function MasterCtrl(t,e,http,timeout){
	var o=992;
	t.getWidth=function(){
		return window.innerWidth
	},
	t.$watch(t.getWidth,function(g){
		t.toggle=g>=o?angular.isDefined(e.get("toggle"))?e.get("toggle")?!0:!1:!0:!1
	}),
	t.toggleSidebar=function(){
		t.toggle=!t.toggle,e.put("toggle",t.toggle)
	},
	window.onresize=function(){
		t.$apply()
	}
	t.autocompletePersonil = function(a, b, c){
		console.log('a',a,'b',b,'c',c);
	}
	t.setZoom = function(map, targetZoom){
		map.setZoom(targetZoom);
	}
	t.peta_propinsi = function(propinsi){
		if(!propinsi){
			t.currentPropinsi = "Semua Propinsi";
			t.map.panTo(new google.maps.LatLng(-2.021918629271336, 113.85840299999995));
			t.setZoom(t.map,5);
		} else {
			var geocoder = new google.maps.Geocoder();
			geocoder.geocode({
			    'address': propinsi.nama_propinsi
			}, function(results, status) {
			    if (status == google.maps.GeocoderStatus.OK) {
			    	t.setZoom(t.map,5);
			    	timeout(function() {
			    		var Lat = results[0].geometry.location.lat();
				      	var Lng = results[0].geometry.location.lng();
				      	t.map.panTo(results[0].geometry.location);
				      	timeout(function() {
				      		if(propinsi.nama_propinsi==="DKI JAKARTA"){
					      		t.setZoom(t.map,11);
					      	} else if(propinsi.nama_propinsi==="SUMATERA UTARA"){
					      		t.setZoom(t.map,7);
					      	} else {
					      		t.setZoom(t.map,8);
					      	}
				      	}, 500);
			    	}, 500);
			      	t.currentPropinsi = propinsi.nama_propinsi;
			    } else {
			      	alert("Something got wrong " + status);
			    }
			});
		}	
	}
	t.currentPropinsi = "Semua Propinsi";
	http.post('api/index.php/dashboard/data').success(function(data){
		console.log(data);
		t.data = data;
		timeout(function() {
			if(jQuery('#level-chart').length>0) t.initMap();
		}, 500);
		if(jQuery('#level-chart').length>0)
		setTimeout(function() {
						
			
			// Make monochrome colors
			Highcharts.chart('level-chart', {
		        chart: {
		            type: 'pie',
					 plotBackgroundColor: null,
    				 plotBorderWidth: null,
    				 plotShadow: false,
		            options3d: {
		                enabled: true,
		                alpha: 30,
		                depth: 100,
		                viewDistance: 25
		            }
					
		        },
		        title: {
		            text: 'Grafik Tingkatan Personil'
					
		        },
		        tooltip: {
		            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
		        },
		          plotOptions: {
					  
		 		  
		  // Membuat plot baru terhadap modified chart
		  		 pie: {		
            		allowPointSelect: true,
					//colorByPoint: true,
           			cursor: 'pointer',
					//style.color: "red",
					//colors: pieColors,
					depth : 30,
            		dataLabels: {
                	enabled: false
            	},
            		showInLegend: true
        		}
    		},
			
				//Untuk Slice (Potongan) cahrt model pie
		        series: [{
		            //type: 'pie',
					//colorByPoint: true,
		            name: 'Persentase ',
					colorByPoint: true,
		            data: [
						   
						//Jika ingin Menggunakan mode parameter modified untuk memanggil data ke Hidhchart PIE <-- Ambil Script dibawah ini ! -->
		                //--['Chief', 
						//--  typeof data.level.C !== 'undefined' ? parseInt(data.level.C) : 0],
						
						//Menggunakan mode script default
						{
		                    name: 'Chief',
							color: 	'#FF0000',
							depth : 25,
		                    y: typeof data.level.C !== 'undefined' ? parseInt(data.level.C) : 0,
						},
						
						{
		                    name: 'Danru',
							color: 	'#00008B',
							depth : 25,
		                    y: typeof data.level.D !== 'undefined' ? parseInt(data.level.D) : 0,
						},
					
		                {
		                    name: 'Satpam',
							color: '#FFD700',
							depth : 25,
		                    y: typeof data.level.S !== 'undefined' ? parseInt(data.level.S) : 0,
							sliced: true,
		                    selected: true
		                },
		            ],
				}]
		    });
			
			//Masuk dala
		 	t.total_personil = 0;
		 	t.kualifikasi = [];
		    angular.forEach(data.kualifikasi, function(v,k){
		    	t.total_personil += v.y;
		    });
		    angular.forEach(data.kualifikasi, function(v,k){
		    	var color;
		    	var textcolor;
		    	switch(v.name){
		    		case 'GADA UTAMA': color = "red"; textcolor = "#ffffff"; break;
		    		case 'GADA MADYA': color = "yellow"; textcolor = "#000000"; break;
		    		case 'GADA PRATAMA': color = "blue"; textcolor = "#ffffff"; break;
		    		default : color = "#eee"; textcolor = "#000000"; break;
		    	}
		    	t.kualifikasi.push([
		    		v.name,
		    		v.y,
		    		(100 / t.total_personil * v.y).toFixed(2),
		    		color,
		    		textcolor
		    		]);
		    });

		    timeout(function(){
		    	angular.forEach(t.kualifikasi, function(v,k){
		    		jQuery('#kualifikasi-value-'+k).animate({
		    			height : v[2]+'%'
		    		}, 1000);
		    	})
		    },4000);

		    var absen_x = [], absen_y = [], absen_y_2 = [];
		    for (var i = 0; i < 31; i++) {
		    	absen_x.push(i+1);
		    	absen_y.push(8);
		    	absen_y_2.push(14);
		    }
		    // Highcharts.chart('timesheet-chart', {
		    //     chart: {
		    //         type: 'column',
		    //         options3d: {
		    //             enabled: true,
		    //             alpha: 2,
		    //             beta: 0,
		    //             depth: 200
		    //         },
		    //     },
		    //     title: {
		    //         text: 'Grafik Proyek Per Propinsi'
		    //     },
		    //     subtitle: {
		    //     },
		    //     plotOptions: {
		    //         column: {
		    //             depth: 25
		    //         },
		    //         showInLegend: false
		    //     },
		    //     xAxis: {
		    //         categories: absen_x
		    //     },
		    //     legend: {
		    //         enabled: false
		    //     },
		    //     yAxis: {
		    //         title: {
		    //             text: null
		    //         }
		    //     },
		    //     series: [{
		    //         name: 'Total Proyek',
		    //         data: absen_y
		    //     }]
		    // });
			
			<!----Chart Proyek Per propinsi --->
		    //var dynamicChart = jQuery('#timesheet-chart');
		    //Highcharts.chart('propinsi-chart', {
		    //    chart: {
		    //        type: 'column',
		    //        options3d: {
		    //            enabled: false,
		    //            alpha: 10,
		    //            beta: 20,
		    //            depth: 30
		    //        },
		    //    },
		    //    title: {
		    //        text: 'Grafik Proyek Per Propinsi'
		    //    },
		    //    subtitle: {
		            // text: 'Notice the difference between a 0 value and a null point'
		    //    },
		    //    plotOptions: {
		    //        column: {
		    //            depth: 25
		    //       },
		    //        showInLegend: false
		    //    },
		    //    xAxis: {
		    //        categories: data.propinsi[0]
		    //    },
		    //    legend: {
		    //        enabled: false
		    //    },
		    //    yAxis: {
		    //        title: {
		    //            text: null
		    //        }
		    //    },
		    //    series: [{
		    //        name: 'Total Proyek',
		    //        data: data.propinsi[1]
		    //    }]
		    //});
			
<!---- Proyek Per Propinsi Baru --->			
			Highcharts.chart('grafikpropinsi', {
  					chart: {
    				type: 'line'
  			},
  				title: {
    				text: 'Grafik Proyek Per Propinsi'
  			},
  				subtitle: {
    				text: 'Berdasarkan Data Integrasi'
  			},
  					xAxis: {
    				categories: data.propinsi [0]
  			},
  					yAxis: {
    		title: {
      			text: null
    			}
  			},
  				plotOptions: {
    				line: {
      				dataLabels: {
        			enabled: true
      			},
      				enableMouseTracking: false
    				}
  				},
  		series: [{
    		name: 'Total Proyek',
    		data: data.propinsi[1]
  				}]
		});

		    Highcharts.chart('11', {
		        chart: {
		            type: 'column',
		            options3d: {
		                enabled: false,
		                alpha: 10,
		                beta: 20,
		                depth: 30
		            },
		        },
		        title: {
		            text: 'Grafik Kejadian Berdasarkan Kategori'
		        },
		        subtitle: {
		            // text: 'Notice the difference between a 0 value and a null point'
		        },
		        plotOptions: {
		            column: {
		                depth: 25
		            },
		            showInLegend: false
		        },
		        xAxis: {
		            categories: data.kategori_kejadian[0]
		        },
		        legend: {
		            enabled: false
		        },
		        yAxis: {
		            title: {
		                text: null
		            }
		        },
		        series: [{
		            name: 'Total Kejadian',
		            data: data.kategori_kejadian[1]
		        }]
		    });
		}, 1000);
	});
	
	t.initMap = function() {
        t.map = new google.maps.Map(document.getElementById('map_dashboard'), {
          zoom: 5,
          center: new google.maps.LatLng(-2.021918629271336, 113.85840299999995),
          mapTypeId: 'roadmap'
        });

        var iconBase = 'https://maps.google.com/mapfiles/kml/shapes/';
        var icons = {
          proyek: {
            icon: 'data:image/png;base64,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'
          },
          klien: {
            icon: iconBase + 'buildings.png'
          },
          cabang: {
            icon: iconBase + 'road_shield1.png'
          }
        };

        t.addMarker = function(feature) {
          var marker = new google.maps.Marker({
            position : feature.position,
            icon : icons[feature.type].icon,
            map : t.map,
            title : feature.title,
            animation : google.maps.Animation.DROP
          });
        }


        t.features = [];
        angular.forEach(t.data.cabang, function(v,k){
        	t.features.push({
        		type : 'cabang',
        		position : new google.maps.LatLng(parseFloat(v.map_latitude), parseFloat(v.map_longitude)),
        		title : v.nama_cabang
        	});
        	console.log(v);
        });
        angular.forEach(t.data.proyek, function(v,k){
        	t.features.push({
        		type : 'proyek',
        		position : new google.maps.LatLng(parseFloat(v.map_latitude), parseFloat(v.map_longitude)),
        		title : v.nama_proyek
        	});
        	console.log(v);
        });
        angular.forEach(t.data.klien, function(v,k){
        	t.features.push({
        		type : 'klien',
        		position : new google.maps.LatLng(parseFloat(v.map_latitude), parseFloat(v.map_longitude)),
        		title : v.nama_klien
        	});
        	console.log(v);
        });
        // {position: new google.maps.LatLng(-3.021918629271336, 113.85840299999995),type: 'cabang'};


        for (var i = 0, feature; feature = t.features[i]; i++) {
          t.addMarker(feature);
        }
		
		  var legend = document.getElementById('legend');
        for (var key in icons) {
          var type = icons[key];
          var name = type.name;
          var icon = type.icon;
          var div = document.createElement('div');
          div.innerHTML = '<img src="' +  icon + '"> ' + key;
          legend.appendChild(div);
        }
        //console.log(type);

        t.map.controls[google.maps.ControlPosition.LEFT_BOTTOM].push(legend);
        google.maps.event.addListenerOnce(t.map, 'idle', function(){
		    document.getElementById('legend').style.display = "block";
		});
    }	
}

angular.module("RDash").controller("MasterCtrl",["$scope","$cookieStore","$http","$timeout",MasterCtrl]);
angular.module("RDash").controller("Dashboard",["$scope","$cookieStore",function(s,c){
	// alert('OK');
}]);
(function (ng) {
  'use strict';

  var app = ng.module('ngLoadScript', []);

  app.directive('script', function() {
    return {
      restrict: 'E',
      scope: false,
      link: function(scope, elem, attr) {
        if (attr.type === 'text/javascript-lazy') {
          var code = elem.text();
          var f = new Function(code);
          f();
        }
      }
    };
  });

}(angular));